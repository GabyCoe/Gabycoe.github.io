<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Restaurant ‚Äî AddictOC√©liaque</title>
  <meta name="description" content="Fiche restaurant sans gluten test√©e (AddictOC√©liaque)." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f19;
      --panel: rgba(255,255,255,0.08);
      --panel2: rgba(255,255,255,0.06);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.66);
      --border: rgba(255,255,255,0.12);
      --shadow: 0 20px 60px rgba(0,0,0,0.45);
      --radius: 18px;
      --radius2: 14px;
      --max: 1120px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(99,102,241,0.35), transparent 60%),
        radial-gradient(900px 500px at 85% 10%, rgba(16,185,129,0.25), transparent 55%),
        radial-gradient(1000px 800px at 30% 120%, rgba(244,63,94,0.18), transparent 60%),
        var(--bg);
      min-height: 100vh;
    }
    a{ color: inherit; text-decoration:none; }
    .wrap{ max-width: var(--max); margin: 0 auto; padding: 22px 18px 60px; }

    /* Top bar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 6px; gap: 12px;
    }
    .brand{ display:flex; align-items:center; gap: 10px; font-weight: 800; letter-spacing:-0.02em; }
    .logo{
      width:34px; height:34px; border-radius:12px;
      background: linear-gradient(135deg, rgba(99,102,241,1), rgba(16,185,129,1));
      box-shadow: 0 10px 30px rgba(99,102,241,0.25);
      display:flex; align-items:center; justify-content:center;
      font-weight:900; font-size:18px; color: rgba(255,255,255,0.95);
    }
    .nav{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; color: var(--muted); font-weight:600; font-size:14px; }
    .nav a{ padding: 8px 10px; border-radius:999px; }
    .nav a:hover{ background: rgba(255,255,255,0.06); color: var(--text); }

    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
    }
    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap: 18px;
      align-items:start;
    }

    /* Sidebar list */
    .side{ padding: 14px; }
    .sideTitle{ display:flex; justify-content:space-between; align-items:baseline; gap:12px; padding: 6px 6px 10px; }
    .sideTitle h2{ margin:0; font-size:15px; }
    .count{ color: var(--muted); font-size:12.5px; }
    .sideSearch{
      margin: 0 6px 10px;
      display:flex; gap:10px; align-items:center;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .sideSearch input{
      width:100%;
      border:0; outline:none;
      background:transparent;
      color: var(--text);
      font-size:14px;
    }
    .sideSearch input::placeholder{ color: rgba(255,255,255,0.48); }
    .list{ display:flex; flex-direction:column; gap:10px; padding: 0 6px 6px; max-height: calc(100vh - 220px); overflow:auto; }
    .row{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 12px;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      gap: 10px;
    }
    .row:hover{ background: rgba(255,255,255,0.07); }
    .row.active{
      outline: 2px solid rgba(16,185,129,0.30);
      background: rgba(16,185,129,0.10);
    }
    .rowName{ font-weight:900; margin:0 0 4px; letter-spacing:-0.01em; }
    .rowMeta{ margin:0; color: var(--muted); font-size:12.5px; line-height:1.35; }
    .rowScore{
      font-weight:900;
      font-size:12.5px;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      height: fit-content;
      white-space:nowrap;
    }

    /* Detail */
    .detail{ overflow:hidden; }
    .heroImg{
      width:100%;
      height: 320px;
      object-fit: cover;
      display:block;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.2);
    }
    .detailTop{ padding: 16px; display:flex; justify-content:space-between; align-items:flex-start; gap: 12px; }
    .title{ margin:0; font-size: 22px; font-weight: 900; letter-spacing:-0.02em; line-height:1.15; }
    .meta{ margin: 8px 0 0; color: var(--muted); font-size: 13.5px; line-height:1.5; }
    .pillRow{ display:flex; gap: 8px; flex-wrap:wrap; margin-top: 10px; }
    .pill{
      font-size: 12px;
      color: rgba(255,255,255,0.78);
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      padding: 7px 10px;
      border-radius: 999px;
    }
    .note{ padding: 0 16px 16px; margin:0; font-size: 15px; line-height:1.6; }
    .actions{ padding: 0 16px 18px; display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      font-weight: 800;
      font-size: 14px;
      display:inline-flex;
      gap: 10px;
      align-items:center;
      cursor:pointer;
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(99,102,241,1), rgba(16,185,129,1));
      border: 0;
      box-shadow: 0 14px 40px rgba(99,102,241,0.22);
    }
    .btn:active{ transform: translateY(1px); }

    .empty{
      padding: 16px;
      color: var(--muted);
      font-size: 14px;
      line-height:1.6;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .list{ max-height: 340px; }
      .heroImg{ height: 240px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo">C</div>
        <a href="./index.html" style="font-weight:900; color:inherit">AddictOC√©liaque</a>
      </div>
      <div class="nav">
        <a href="./index.html#restaurants">Restaurants</a>
        <a href="./index.html#carte">Carte</a>
        <a href="./index.html#suggestion">Sugg√©rer</a>
      </div>
    </div>

    <div class="grid">
      <!-- Sidebar -->
      <aside class="card side">
        <div class="sideTitle">
          <h2>Restaurants</h2>
          <div class="count" id="count">‚Äî</div>
        </div>

        <div class="sideSearch" title="Recherche">
          <span style="opacity:.7;">üîé</span>
          <input id="q" placeholder="Rechercher un resto‚Ä¶" />
        </div>

        <div class="list" id="list"></div>
      </aside>

      <!-- Detail -->
      <main class="card detail" id="detail">
        <img id="img" class="heroImg" alt="" style="display:none;">
        <div class="detailTop">
          <div>
            <h1 class="title" id="name">‚Äî</h1>
            <p class="meta" id="meta">‚Äî</p>
            <div class="pillRow" id="tags"></div>
          </div>
          <div class="rowScore" id="score">‚≠ê ‚Äî</div>
        </div>
        <p class="note" id="note">‚Äî</p>
        <div class="actions">
          <a class="btn primary" id="gmaps" target="_blank" rel="noopener">üó∫Ô∏è Itin√©raire</a>
          <a class="btn" id="site" target="_blank" rel="noopener" style="display:none;">üîó Site</a>
          <button class="btn" id="copy">üìé Copier le lien</button>
        </div>
        <div class="empty" id="empty" style="display:none;">
          Resto introuvable. Retourne √† la liste et choisis un restaurant.
        </div>
      </main>
    </div>
  </div>

  <!-- Data files -->
  <script src="./restaurants.js"></script>
  <script src="./utils.js"></script>

  <script>
    // ---- Helpers (fallback si utils.js ne contient pas tout) ----
    const getParam = (k) => new URLSearchParams(window.location.search).get(k);
    const safe = (v, fallback="‚Äî") => (v === undefined || v === null || v === "" ? fallback : v);

    // On supporte 2 formats :
    // 1) window.RESTAURANTS (recommand√©)
    // 2) const restaurants = [...] (ancien)
    const DATA = (window.RESTAURANTS && Array.isArray(window.RESTAURANTS))
      ? window.RESTAURANTS
      : (window.restaurants && Array.isArray(window.restaurants))
        ? window.restaurants
        : [];

    const tagLabel = (t) => {
      const dict = {
        dedicated_gf: "D√©di√© GF",
        brunch: "Brunch",
        takeout: "Takeout",
        pizza: "Pizza",
        vegan: "Vegan",
        wifi: "Wi-Fi",
        happy_hour: "Happy hour"
      };
      return dict[t] || t;
    };

    const listEl = document.getElementById("list");
    const countEl = document.getElementById("count");
    const qEl = document.getElementById("q");

    const imgEl = document.getElementById("img");
    const nameEl = document.getElementById("name");
    const metaEl = document.getElementById("meta");
    const tagsEl = document.getElementById("tags");
    const noteEl = document.getElementById("note");
    const scoreEl = document.getElementById("score");
    const gmapsEl = document.getElementById("gmaps");
    const siteEl = document.getElementById("site");
    const copyBtn = document.getElementById("copy");
    const emptyEl = document.getElementById("empty");

    function renderList(activeId, query=""){
      const q = query.trim().toLowerCase();
      const filtered = DATA.filter(r => {
        const hay = [r.name, r.city, r.neighborhood, r.address, r.note, ...(r.tags||[])].join(" ").toLowerCase();
        return !q || hay.includes(q);
      });

      countEl.textContent = filtered.length + (filtered.length > 1 ? " restos" : " resto");
      listEl.innerHTML = "";

      filtered.forEach(r => {
        const row = document.createElement("div");
        row.className = "row" + (r.id === activeId ? " active" : "");
        row.tabIndex = 0;

        const left = document.createElement("div");
        const n = document.createElement("p");
        n.className = "rowName";
        n.textContent = safe(r.name, "‚Äî");

        const m = document.createElement("p");
        m.className = "rowMeta";
        m.textContent = `${safe(r.city)} ‚Ä¢ ${safe(r.neighborhood, "‚Äî")}`;

        left.appendChild(n);
        left.appendChild(m);

        const sc = document.createElement("div");
        sc.className = "rowScore";
        sc.textContent = `‚≠ê ${safe(r.scoreLabel ?? r.score, "‚Äî")}`;

        row.appendChild(left);
        row.appendChild(sc);

        const go = () => {
          window.location.href = `restaurant.html?id=${encodeURIComponent(r.id)}`;
        };
        row.addEventListener("click", go);
        row.addEventListener("keydown", (e) => { if (e.key === "Enter") go(); });

        listEl.appendChild(row);
      });

      return filtered;
    }

    function showDetail(id){
      const r = DATA.find(x => x.id === id);

      if (!r){
        emptyEl.style.display = "block";
        imgEl.style.display = "none";
        nameEl.textContent = "Restaurant introuvable";
        metaEl.textContent = "‚Äî";
        noteEl.textContent = "‚Äî";
        scoreEl.textContent = "‚≠ê ‚Äî";
        tagsEl.innerHTML = "";
        gmapsEl.href = "./index.html";
        siteEl.style.display = "none";
        return;
      }

      emptyEl.style.display = "none";

      document.title = `${r.name} ‚Äî AddictOC√©liaque`;

      nameEl.textContent = safe(r.name);
      metaEl.textContent = `${safe(r.city)} ‚Ä¢ ${safe(r.neighborhood, "‚Äî")} ‚Ä¢ ${safe(r.price, "‚Äî")} ‚Ä¢ ${safe(r.address)}`;
      noteEl.textContent = safe(r.note, "");

      scoreEl.textContent = `‚≠ê ${safe(r.scoreLabel ?? r.score, "‚Äî")}`;

      // Image
      if (r.image){
        imgEl.style.display = "block";
        imgEl.src = r.image;
        imgEl.alt = r.name || "";
        imgEl.onerror = () => { imgEl.style.display = "none"; };
      } else {
        imgEl.style.display = "none";
      }

      // Tags
      tagsEl.innerHTML = "";
      (r.tags || []).forEach(t => {
        const p = document.createElement("div");
        p.className = "pill";
        p.textContent = tagLabel(t);
        tagsEl.appendChild(p);
      });

      // Google maps
      const q = encodeURIComponent(r.address || `${r.lat},${r.lon}`);
      gmapsEl.href = `https://www.google.com/maps/search/?api=1&query=${q}`;

      // Website
      if (r.website){
        siteEl.style.display = "inline-flex";
        siteEl.href = r.website;
      } else {
        siteEl.style.display = "none";
      }

      // Copy link
      copyBtn.onclick = async () => {
        const url = window.location.href;
        try{
          await navigator.clipboard.writeText(url);
          copyBtn.textContent = "‚úÖ Lien copi√©";
          setTimeout(() => (copyBtn.textContent = "üìé Copier le lien"), 1200);
        } catch {
          // fallback
          window.prompt("Copie ce lien :", url);
        }
      };
    }

    function init(){
      const id = getParam("id") || (DATA[0] && DATA[0].id);
      renderList(id, "");
      showDetail(id);

      // Search in sidebar
      qEl.addEventListener("input", () => {
        const activeId = getParam("id");
        renderList(activeId, qEl.value);
      });

      // Keyboard navigation (‚Üë ‚Üì) dans la liste filtr√©e
      document.addEventListener("keydown", (e) => {
        if (!["ArrowUp","ArrowDown"].includes(e.key)) return;
        const activeId = getParam("id");
        const filtered = DATA.filter(r => {
          const q = qEl.value.trim().toLowerCase();
          if (!q) return true;
          const hay = [r.name, r.city, r.neighborhood, r.address, r.note, ...(r.tags||[])].join(" ").toLowerCase();
          return hay.includes(q);
        });
        const idx = filtered.findIndex(r => r.id === activeId);
        if (idx === -1) return;

        e.preventDefault();
        const next = (e.key === "ArrowDown")
          ? filtered[Math.min(idx+1, filtered.length-1)]
          : filtered[Math.max(idx-1, 0)];

        if (next && next.id !== activeId){
          window.location.href = `restaurant.html?id=${encodeURIComponent(next.id)}`;
        }
      });
    }

    init();
  </script>
</body>
</html>
